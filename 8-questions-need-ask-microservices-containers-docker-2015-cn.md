##羊年八问微服务、容器与Docker

【编者的话】

坐在这里，想想过去的```Eat-a-thon```假期没有什么比熬过假期里得的轻微感冒更糟糕的事，并回顾2014年，我觉得那是IT届相当重要的一年。可以公平地说，在Docker，更宽泛的来讲，[容器](http://www.wikiwand.com/en/Operating-system-level_virtualization)和[微服务](http://martinfowler.com/articles/microservices.html)，我们正面临着自从虚拟机的到来后在如何交付和运行软件服务上的潜在巨大变化。

这种潜在的变化不仅带来很多的兴趣和热情，难免地也带来了很多的炒作和趋之若鹜。但在所有这些议论中，我们要牢记它真的还很年轻。不仅仅是技术，还有围绕着微服务、容器以及Docker的程序与练习：几乎这个范围内的一切东西要么还在等待被发明，要么就是需要大量的细微调整。

这有涉及容器的8个问题我认为每个组织都需要在做任何决定之前进行调查：存储，容错，交付模型，发布策略，所有权，补丁，支持和许可。

不要误会我的意思：我觉得微服务和[物联网](http://www.wikiwand.com/en/Internet_of_Things)将成为我们设计与交付IT服务方式的核心部分（在越来越多的分散的计算能力与更大数据量被拉回到中央位置之间有一种有趣的张力。因为我们无法处理它，否则它将是一篇不同博文的话题）。在[XebiaLabs roadmap](http://xebialabs.com/products/)上微服务扮演了重要的功能角色，我认为每一个组织必须至少调查他们，并且容器是一个非常有前途的候选实现技术。

尽管如此，我认为卖力的“Let’s Dockerize everything”，我们看到组织走上相当疯狂prematurebrave举措。把它放在一个更微妙的方式：如果你已经确定容器以及它会表现出显著的技术好处，特别是Docker，将带给你应用程序的交付，你有什么样的技术资源，在您的处置，可以发现解决方案到复杂的，尚未解决的问题，并愿意去通过客户流失和重新实现附带任何1.x版技术，然后采用现在肯定是有道理的。

但如果你要完全基于“containers will make everything better,”来容器化一切，并期待能结合现有的现成的现成解决方案，让您的团队在一些最佳实践上训练，并迅速地有一个稳定、安全的运行平台并且在运行中，它将会给你带来有很大的惊喜。

话虽如此，并给予我的微服务的信念，我认为企业不断研究容器（Docker、[Mesos](https://mesos.apache.org/)、[Rocket](https://coreos.com/blog/rocket/)或者任何不久我们将无疑会看到的其他替代品）如何可以为他们的工作是至关重要的。在最近的一些讨论的基础上，这里有八个问题我认为任何一个组织都需要考虑在2015年：

###1. 存储

也许现在最明显的技术问题是：如何处理持久、可写的存储容器？如何以及在何处存储数据？如何从容器中连接到它？如何复制与备份它？如何让数据随着容器迁移如果在不同的机器上启动一个容器以及如何迅速地做这一切？

###2. 容错

在一个微服务环境中，寻找其他终端服务的常见方法需要告知其去查询某种服务Registry，以及/或者为服务使用稳定的名称来解决这些实际的终端，例如DNS。在带来了一个新的虚拟机可能需要几分钟的环境里，采取服务注册或是DNS缓存来更新相对来说耗时比较少。用容器的话只需要几秒就可以，终端的重新绑定很快会成为一个瓶颈，尤其是如果有许多容器同时发生故障。

我最近看到了一个令人印象深刻的解决方案，它使用的是商品硬件，其能够从一个全机架故障中恢复－重新启动、重新挂载和重新绑定10,000个容器－不超过10秒。但是这一切都是定制的引擎和实验...在货架上你得不到这种东西。

你的容错要求有哪些？你与容器会如何定位这些？

###3. 交付模型

如果你要部署容器，开发商将要交付什么？他们是否要交付容器的描述符（Dockerfile或者类似其他）？如果交付的话，你怎么绕过的描述所引用的任何外部资源？抑或是开发商要提供“编译”的形象，避免了外部的依赖问题，但增加了可交付的大小，使之更难收件人检查或验证什么是真正将要运行。

或者是你希望避免要求开发者学习又“发送格式”（让开发人员学习木偶，厨师或类似配置的“语言”的难度是我们听到的关于组织试图向他们介绍的主要问题之一作为开发商交付），并正在寻找某种方式从同一代码工件，开发商今天提供“自动生成”容器描述或图像？

###4. 发布策略

是你的服务足够的独立性，为您能够将每个服务部署到生产的每一个承诺，或者在设定的时间表？或者你需要的，如果成功在释放列车类型的设置，其中的多个服务的最新候选版本进行了测试捆绑多种业务，并且，每天，每周等基础上发布了起来呢？如果是后者，有多少发行火车，你会用？一个用于整个组织？每一个团队或业务单位？

作为候选版本的发布列车的数量上升，测试失败的机会通常也会增加。你是否中止发行的火车，如果任何测试失败，从而可能阻止199“好”的服务，从去现场，因为一个问题吗？或者它是有意义的尝试删除“烂苹果”，并重新测试其余的候选人？

对于实际生产部署，将创建一个完整的“镜子”的环境（可能是一个用于您最广泛的测试，在发布的火车？），然后逐渐指挥交通了呢？还是你只是一起部署现有的新的服务？如果是这样，你怎么处理逐渐放气了，铭记，新服务可能不是那些直接遭受用户？还是你，而不是切换到新的服务完全，依靠快速切换回来，如果有问题的能力？如果是这样，你一次切换一个服务（当然，集群的相互依存服务，真的）的时间，或所有？

###5. 所有权

关于集装箱的交付模式所决定的一部分，也是谁拥有/负责这一块的交付成果。操作是否简单地提供容器运行时，与开发商负责这种情况发生在容器内的任何问题？是操作还负责“基地描述符”或“基本映像”从每个开发人员提供的容器必须继承？如何确定是否一个问题是由图像，或显影剂补充部分的“基地”部分造成的，特别是如果该技术允许开发人员修改或覆盖基本图像的部分？

还有一个与安全有关的方面对这些问题：你能充分隔离/沙箱集装箱，以防止其影响其它系统？或者你只是相信，由开发团队提供的描述符/图像不会做“坏事” - 无意或以其他方式？

如果你想给的提供完整的容器描述您的开发团队的责任和信任他们做正确的事，也是在类似的事情配置文件系统的容器来说，你有没有问他们是否会愿意支持系统中生产的？

###6. 补丁

您需要更改运行的系统，如能力应用安全补丁或其他重要变化？如果你正在考虑采取一成不变的基础设施建设的原则，多快，你可以更新所有受影响的容器定义或图像，并发布新版本？如果补丁可以应用到基本描述或图像的开发团队使用，你能“覆盖”在其构建过程中使用的还是这要求所有的开发团队，以改变他们的源代码的基础图像/构建定义。

如果你正在考虑修改运行容器，确保容器技术，您正在考虑支持这一点，并且还提供了一个审计线索。您将如何确保运行容器所做的任何更改找到自己的方式回到容器定义？

###7. 支持

最近，我听到了下面的故事：一个公司在一个操作系统，他们有一个支持合同运行泊坞窗。但在泊坞窗运行容器中使用的基本图像与不支持的操作系统。突然，没有了“机”（即容器）即得到有效托管其应用程序的支持。当他们开始有问题，他们的支持合同并没有帮助他们。

你有在地方的任何可能运行在你的容器必要的支持措施？

###8. 许可

如果您使用的是被许可在每个系统中的服务的任何组件，你检查有关容器是供应商的许可政策？供应商是否考虑每个容器一个独立的系统，或者他们认为简单地，实际上是托管容器框架系统中的进程？换句话说，如果你在一台机器上运行许可程序的10个实例现在，将你的成本保持不变，如果你在容器中运行它们，或者将它由一个完整的订单或幅度增加吗？

这么多的问题...但什么样的答案？不幸的是，基于许多谈话，我觉得在这一点上坦率的回答是：没有人知道。在一些地区，有很多有趣的想法，但没有明显的赢家呢。其他问题现在才显示出了对讨论的雷达，而且在许多情况下，“正确”答案将在很大程度上取决于企业的具体情况。

幸运的是，由于步伐哪些事情正在发生的事情，我想我们会知道很多更多的同一时间在明年。这里是一个令人兴奋的2015年！


**原文链接：[8 Questions You Need to Ask About Microservices, Containers & Docker in 2015](http://blog.xebialabs.com/2014/12/31/8-questions-need-ask-microservices-containers-docker-2015/) （翻译：[田浩](https://github.com/llitfkitfk)）**